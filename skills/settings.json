{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Security check. Check if this command is safe: $ARGUMENTS. Look for: hardcoded secrets, rm -rf, SQL injection via shell, exposure of sensitive data. Respond {\"ok\": true} if safe, {\"ok\": false, \"reason\": \"...\"} if dangerous.",
            "timeout": 15
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Security gate. Check this file change for: hardcoded API keys or secrets, SQL injection, XSS, auth bypass, PII in logs or URLs. $ARGUMENTS. Respond {\"ok\": true} if safe, {\"ok\": false, \"reason\": \"...\"} if a blocking issue is found. Only block on clear violations, not potential issues.",
            "timeout": 15
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "agent",
            "prompt": "Test verification.\n\nRun `npm test`. If Playwright tests exist in tests/e2e/, run `npx playwright test` too.\n\nRead CLAUDE.md, then append results to the \"## Test Report\" section using the Edit tool:\n\n**Date:** [date] | **Passed:** [count] | **Failed:** [count] | **Skipped:** [count]\n[failure details if any]\n\nGate: if tests fail, respond {\"ok\": false, \"reason\": \"X tests failing: [details]\"}. If tests pass, respond {\"ok\": true}.",
            "timeout": 60
          },
          {
            "type": "agent",
            "prompt": "Pre-stop audit. Three checks: trust, strategy, design.\n\n## Trust Deep Scan\n\nScan all files changed in this session for:\n1. Hardcoded API keys, passwords, tokens, secrets\n2. SQL injection (unsanitized user input in queries)\n3. XSS (unescaped user content rendered as HTML)\n4. Auth bypass (missing auth checks on protected routes)\n5. PII exposure (personal data in logs, errors, URLs)\n6. Missing RLS policies on Supabase tables\n7. Secrets in environment config committed to git\n\n## Strategy Alignment Check\n\nRead CLAUDE.md to understand the EIID mapping and project goals.\nCheck recent changes against the EIID framework:\n- Do changes support one of the four layers (Enrichment, Inference, Interpretation, Delivery)?\n- Any scope creep?\n- Any new opportunities across the four layers?\n\n## Design Audit\n\nScan all .tsx files for violations of these five rules:\n1. shadcnblocks FIRST — If a shadcnblocks block exists for a UI section, use it.\n2. shadcn base SECOND — If no block fits, use standard shadcn components.\n3. NEVER custom CSS classes — Tailwind utilities only.\n4. Global token file required — globals.css defines CSS custom properties.\n5. Zero inline arbitrary values — Tailwind scale values and theme classes only.\nAlso check: color contrast >= 4.5:1, focus states, alt text, form labels.\n\n## Report to CLAUDE.md\n\nRead CLAUDE.md, then append all findings using the Edit tool to the relevant sections (Security Findings, Architecture Decisions, Design Findings).\n\nAdvisory only. Respond {\"ok\": true} when done.",
            "timeout": 60
          }
        ]
      }
    ]
  }
}
